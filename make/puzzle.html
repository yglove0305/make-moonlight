<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>í¼ì¦ ë§¤ì¹­ ê²Œì„ â€” ë ˆë²¨ 10</title>
  <style>
    /* ========= ê¸°ë³¸ ìŠ¤íƒ€ì¼ ========= */
    :root{
      --bg:#101318;
      --panel:#171a21;
      --panel-2:#1e232b;
      --accent:#5ee6ad;
      --accent-2:#78a9ff;
      --accent-3:#ffb86b;
      --text:#e6edf3;
      --muted:#9aa3ab;
      --danger:#ff6b6b;
      --success:#3ddc97;
      --warning:#ffd166;

      --radius:14px;
      --gap:10px;
      --card-size:80px;   /* ì¹´ë“œ ê¸°ë³¸ í¬ê¸° (ë ˆë²¨ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ì¡°ì •ë¨) */
      --shadow:0 10px 25px rgba(0,0,0,0.45);
    }
    *{box-sizing:border-box}
    html,body{
      height:100%;
      background:linear-gradient(120deg, #0b1016, #151a22 60%, #0b1016 100%);
      color:var(--text);
      font-family:system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Helvetica, Arial, sans-serif;
    }
    body{
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }

    /* ========= ì»¨í…Œì´ë„ˆ ========= */
    .app{
      width:min(1100px, 95vw);
      background:linear-gradient(180deg, var(--panel), var(--panel-2));
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      border:1px solid #0d0f13;
      overflow:hidden;
    }
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:18px 22px;
      border-bottom:1px solid #0f1318;
      background:linear-gradient(180deg, #13171c, #171a21);
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }
    .brand .logo{
      width:38px;height:38px;
      display:grid;place-items:center;
      border-radius:10px;
      background:radial-gradient(125% 125% at 10% 10%, #2a2f38 0, #20242b 55%, #171a21 100%);
      border:1px solid #0e1116;
      box-shadow:0 12px 22px rgba(0,0,0,0.4) inset, 0 6px 12px rgba(0,0,0,0.35);
      color:var(--accent);
      font-weight:900;
      letter-spacing:0.2px;
    }
    .brand h1{
      font-size:18px;
      margin:0;
      font-weight:700;
    }
    .brand small{
      display:block;
      font-size:12px;
      color:var(--muted);
    }

    /* ========= ìƒíƒœ ë°” ========= */
    .statusbar{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:flex-end;
    }
    .chip{
      display:flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      background:#12161c;
      border:1px solid #0d1015;
      color:var(--text);
      border-radius:10px;
      box-shadow:inset 0 1px 0 rgba(255,255,255,0.04);
      font-size:13px;
    }
    .chip .dot{
      width:8px;height:8px;border-radius:50%;
      background:var(--accent);
      box-shadow:0 0 0 3px rgba(94,230,173,0.15);
    }
    .chip.warn .dot{background:var(--warning); box-shadow:0 0 0 3px rgba(255,209,102,0.15)}
    .chip.good .dot{background:var(--success); box-shadow:0 0 0 3px rgba(61,220,151,0.15)}
    .chip.bad .dot{background:var(--danger); box-shadow:0 0 0 3px rgba(255,107,107,0.15)}

    /* ========= ì»¨íŠ¸ë¡¤ ì˜ì—­ ========= */
    .controls{
      display:grid;
      grid-template-columns: 1fr auto;
      gap:0;
      border-top:1px solid #0f1318;
      background:linear-gradient(180deg, #161a21, #1a1f27);
    }
    .left-controls{
      padding:18px 22px;
      display:flex;
      align-items:center;
      gap:14px;
      flex-wrap:wrap;
      border-right:1px solid #0f1318;
    }
    .right-controls{
      padding:18px 22px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    label{
      font-size:13px;
      color:var(--muted);
    }
    select, button{
      appearance:none;
      font:inherit;
      color:var(--text);
      background:#141821;
      border:1px solid #0b0e13;
      padding:10px 12px;
      border-radius:10px;
      cursor:pointer;
      transition:transform .06s ease, background .2s ease, border-color .2s ease;
      outline:none;
      box-shadow:inset 0 1px 0 rgba(255,255,255,0.045);
    }
    select:focus, button:focus{
      border-color:#263246;
    }
    button.primary{
      background:linear-gradient(180deg, #1f2631, #18202a);
      border-color:#0f1622;
    }
    button.accent{
      background:linear-gradient(180deg, #1b2a24, #16231d);
      border-color:#0e1a15;
      color:#b8ffe0;
    }
    button:hover{
      transform:translateY(-1px);
    }
    button:active{
      transform:translateY(0);
    }
    .kbd{
      display:inline-block;
      padding:2px 6px;
      border-radius:6px;
      background:#0e1218;
      border:1px solid #0c1016;
      color:#a2adba;
      font-size:12px;
      margin-left:6px;
    }

    /* ========= ë³¸ë¬¸ ë ˆì´ì•„ì›ƒ ========= */
    .content{
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:0;
      min-height:520px;
    }
    .panel{
      padding:22px;
      border-right:1px solid #0f1318;
      background:linear-gradient(180deg, #141820, #161b22);
    }
    .panel h2{
      margin-top:0;
      font-size:16px;
    }
    .panel p{
      font-size:14px;
      color:#b4bdc8;
      line-height:1.6;
    }
    .panel .list{
      display:grid;
      gap:8px;
      margin-top:10px;
    }
    .panel .list .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      background:#12161d;
      border:1px solid #0d1117;
      padding:10px 12px;
      border-radius:10px;
      font-size:13px;
    }

    /* ========= ê²Œì„ë³´ë“œ ========= */
    .board-wrap{
      display:flex;
      align-items:center;
      justify-content:center;
      padding:22px;
    }
    .board{
      display:grid;
      gap:var(--gap);
      padding:16px;
      background:linear-gradient(180deg, #13171e, #10141b);
      border:1px solid #0d1117;
      border-radius:16px;
      box-shadow:var(--shadow);
      user-select:none;
      touch-action:manipulation;
    }
    .card{
      width:var(--card-size);
      height:var(--card-size);
      border-radius:12px;
      position:relative;
      transform-style:preserve-3d;
      transition:transform .45s cubic-bezier(.2,.8,.2,1);
      perspective:700px;
      cursor:pointer;
      outline:none;
    }
    .card.is-matched{
      animation:pop .35s ease;
    }
    @keyframes pop{
      0%{transform:scale(1)}
      35%{transform:scale(1.06)}
      100%{transform:scale(1)}
    }
    .face{
      position:absolute; inset:0;
      display:grid; place-items:center;
      border-radius:12px;
      backface-visibility:hidden;
      border:1px solid #0b0f14;
      box-shadow:inset 0 1px 0 rgba(255,255,255,0.05);
    }
    .face.front{
      background:radial-gradient(140% 140% at 120% 0%, #1f2630 0, #141820 60%, #10141b 100%);
      transform:rotateY(0deg);
    }
    .face.back{
      transform:rotateY(180deg);
      background:radial-gradient(140% 140% at 120% 0%, #1c232b 0, #12161d 60%, #0f1318 100%);
    }
    .card.is-flipped{
      transform:rotateY(180deg);
    }
    .emoji{
      font-size:calc(var(--card-size) * 0.55);
      filter:drop-shadow(0 6px 10px rgba(0,0,0,0.4));
    }
    .badge{
      position:absolute;
      top:8px; left:8px;
      padding:2px 6px;
      font-size:11px;
      color:#cfeaff;
      background:#0e1620;
      border:1px solid #0b1118;
      border-radius:8px;
    }
    .front::after{
      content:"";
      position:absolute; inset:-1px;
      border-radius:12px;
      box-shadow:0 0 0 1px rgba(94,230,173,0.08), 0 0 0 10px rgba(94,230,173,0.02);
      pointer-events:none;
    }

    /* ========= íŒíŠ¸ ê°•ì¡° ========= */
    .card.hint .front{
      outline:2px solid rgba(120,169,255,0.55);
      box-shadow:0 0 0 2px rgba(120,169,255,0.35), 0 0 0 8px rgba(120,169,255,0.08);
    }

    /* ========= ë°˜ì‘í˜• ========= */
    @media (max-width: 980px){
      .content{grid-template-columns: 1fr}
      .panel{border-right:none; border-bottom:1px solid #0f1318}
    }
    @media (max-width: 600px){
      :root{ --gap:8px }
      header{padding:14px 16px}
      .left-controls, .right-controls{padding:14px 16px}
    }

    /* ========= ì ‘ê·¼ì„± í¬ì»¤ìŠ¤ ========= */
    .card:focus-visible .front{
      outline:2px solid rgba(94,230,173,0.7);
    }

    /* ========= í† ìŠ¤íŠ¸ ========= */
    .toast{
      position:fixed;
      bottom:18px; left:18px;
      padding:10px 14px;
      background:#0e1319;
      border:1px solid #0b0f14;
      border-radius:10px;
      color:#cdd6df;
      box-shadow:var(--shadow);
      opacity:0; transform:translateY(8px);
      pointer-events:none;
      transition:opacity .25s ease, transform .25s ease;
      font-size:13px;
    }
    .toast.show{opacity:1; transform:translateY(0)}
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="í¼ì¦ ë§¤ì¹­ ê²Œì„">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">PZ</div>
        <div>
          <h1>í¼ì¦ ë§¤ì¹­ ê²Œì„</h1>
          <small>ê¸°ì–µì„ ë§ì¶°ë¼ â€” ë ˆë²¨ 10</small>
        </div>
      </div>
      <div class="statusbar" aria-live="polite">
        <div class="chip good"><span class="dot"></span> <strong>ì‹œê°„:</strong> <span id="time">00:00</span></div>
        <div class="chip"><span class="dot"></span> <strong>ì´ë™:</strong> <span id="moves">0</span></div>
        <div class="chip warn"><span class="dot"></span> <strong>ì ìˆ˜:</strong> <span id="score">0</span></div>
        <div class="chip bad"><span class="dot"></span> <strong>ë‚¨ì€ìŒ:</strong> <span id="pairs-left">0</span></div>
      </div>
    </header>

    <div class="controls" role="region" aria-label="ê²Œì„ ì„¤ì • ë° ì œì–´">
      <div class="left-controls">
        <div>
          <label for="level">ë ˆë²¨ ì„ íƒ</label>
          <select id="level" aria-label="ë ˆë²¨ ì„ íƒ">
            <!-- 10 ë ˆë²¨ê¹Œì§€ ì œê³µ. ê¸°ë³¸ì€ 10 -->
            <option value="1">1 (2x2)</option>
            <option value="2">2 (3x3)</option>
            <option value="3">3 (4x3)</option>
            <option value="4">4 (4x4)</option>
            <option value="5">5 (5x4)</option>
            <option value="6">6 (5x5)</option>
            <option value="7">7 (6x5)</option>
            <option value="8">8 (6x6)</option>
            <option value="9">9 (7x6)</option>
            <option value="10" selected>10 (8x6)</option>
          </select>
        </div>
        <button id="start" class="primary" aria-label="ê²Œì„ ì‹œì‘">ì‹œì‘</button>
        <button id="reset" aria-label="ê²Œì„ ì¬ì„¤ì •">ì¬ì„¤ì •</button>
        <button id="shuffle" aria-label="ì¹´ë“œ ì„ê¸°">ì„ê¸°</button>
        <button id="hint" class="accent" aria-label="íŒíŠ¸ ë³´ê¸°">íŒíŠ¸ <span class="kbd">H</span></button>
      </div>
      <div class="right-controls">
        <button id="sound" aria-pressed="false" aria-label="ì‚¬ìš´ë“œ í† ê¸€">ğŸ”ˆ ì‚¬ìš´ë“œ</button>
        <button id="dark" aria-pressed="true" aria-label="í…Œë§ˆ í† ê¸€">ğŸŒ™ ë‹¤í¬</button>
      </div>
    </div>

    <div class="content">
      <aside class="panel" role="complementary" aria-label="ë„ì›€ë§ ë° í†µê³„">
        <h2>ë„ì›€ë§</h2>
        <p>
          ê°™ì€ ê·¸ë¦¼ ë‘ ì¥ì„ ì—°ì†ìœ¼ë¡œ ë’¤ì§‘ì–´ ìŒì„ ë§ì¶”ì„¸ìš”. ë” ì ì€ ì´ë™ìœ¼ë¡œ ë” ë¹ ë¥´ê²Œ ì™„ì„±í•˜ë©´ ë†’ì€ ì ìˆ˜ë¥¼ ë°›ìŠµë‹ˆë‹¤.
          ë ˆë²¨ì´ ì˜¬ë¼ê°ˆìˆ˜ë¡ ì¹´ë“œ ìˆ˜ê°€ ì¦ê°€í•©ë‹ˆë‹¤.
        </p>

        <div class="list" aria-label="ê²Œì„ í†µê³„">
          <div class="row"><span>ìµœê³  ë ˆë²¨</span><strong id="best-level">10</strong></div>
          <div class="row"><span>ìµœê³  ì ìˆ˜</span><strong id="best-score">0</strong></div>
          <div class="row"><span>ìµœë‹¨ ì‹œê°„</span><strong id="best-time">â€”</strong></div>
          <div class="row"><span>ìµœì†Œ ì´ë™</span><strong id="best-moves">â€”</strong></div>
        </div>

        <h2 style="margin-top:18px">íŒ</h2>
        <ul style="margin:0; padding-left:18px; color:#b4bdc8">
          <li><strong>ì‹œì‘ ì „:</strong> ì„ê¸°ë¥¼ ëˆŒëŸ¬ íŒ¨í„´ì„ ë°”ê¿”ë³´ì„¸ìš”.</li>
          <li><strong>íŒíŠ¸:</strong> 5ì´ˆë§ˆë‹¤ í•œ ì¥ì”© ê°•ì¡°ë©ë‹ˆë‹¤. H í‚¤ë¡œ í† ê¸€.</li>
          <li><strong>ì—°ì† ë§¤ì¹˜:</strong> ì—°ì†ìœ¼ë¡œ ë§ì¶”ë©´ ì¶”ê°€ ì ìˆ˜ ì½¤ë³´!</li>
        </ul>
      </aside>

      <main class="board-wrap">
        <div id="board" class="board" role="grid" aria-label="ì¹´ë“œ ë³´ë“œ"></div>
      </main>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite">ì¤€ë¹„ ì™„ë£Œ!</div>

  <script>
    // ========= ìœ í‹¸ë¦¬í‹° =========
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    const fmtTime = s => {
      const m = Math.floor(s / 60);
      const sec = s % 60;
      return `${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;
    };

    const shuffleArr = arr => {
      for(let i=arr.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]] = [arr[j],arr[i]];
      }
      return arr;
    };

    const toast = (msg, ms=1800) => {
      const t = $('#toast');
      t.textContent = msg;
      t.classList.add('show');
      clearTimeout(toast._timer);
      toast._timer = setTimeout(()=>t.classList.remove('show'), ms);
    };

    // ========= ë ˆë²¨ êµ¬ì„± =========
    // ê° ë ˆë²¨ì€ (ì—´ x í–‰) ê·¸ë¦¬ë“œë¡œ êµ¬ì„±, ì´ ì¹´ë“œ ìˆ˜ëŠ” cols*rows
    // ì¹´ë“œ ìˆ˜ëŠ” ì§ìˆ˜ì—¬ì•¼ í•´ì„œ í•„ìš” ì‹œ í•œ ì¥ ì œê±°/ì¶”ê°€ë¡œ ë§ì¶¥ë‹ˆë‹¤.
    const LEVELS = {
      1:{cols:2, rows:2},
      2:{cols:3, rows:3},         // 9ì¥ -> 8ì¥ìœ¼ë¡œ ì¡°ì •
      3:{cols:4, rows:3},
      4:{cols:4, rows:4},
      5:{cols:5, rows:4},
      6:{cols:5, rows:5},         // 25ì¥ -> 24ì¥ìœ¼ë¡œ ì¡°ì •
      7:{cols:6, rows:5},
      8:{cols:6, rows:6},
      9:{cols:7, rows:6},
      10:{cols:8, rows:6}
    };

    // ========= ì¹´ë“œ ë°ì´í„°(ì´ëª¨ì§€) =========
    // ë ˆë²¨ì— ë”°ë¼ í•„ìš”í•œ ë§Œí¼ ì¶”ì¶œí•˜ì—¬ í˜ì–´ ìƒì„±
    const EMOJIS = [
      "ğŸ€","ğŸŒ™","â­","âš¡","ğŸ”¥","â„ï¸","ğŸŒˆ","ğŸŒŠ","ğŸ’","ğŸŒ¸","ğŸ","ğŸ‰","ğŸ‡","ğŸ‹","ğŸ¥",
      "ğŸ¥¥","ğŸ¥‘","ğŸ§©","ğŸ²","ğŸ¯","ğŸ®","ğŸ¹","ğŸ¨","ğŸš€","ğŸª","â˜„ï¸","ğŸ›°ï¸","ğŸŒ‹","â›°ï¸","ğŸï¸",
      "ğŸŸï¸","ğŸ†","ğŸ§­","ğŸ§±","ğŸ”§","ğŸ”¬","ğŸ§ª","ğŸ“¡","ğŸ’¡","ğŸ“·","ğŸ§","ğŸº","ğŸ»","ğŸ¥","ğŸ­",
      "ğŸª„","ğŸ§ ","ğŸ’»","ğŸ“š","ğŸ“","âœ’ï¸","ğŸ–Œï¸","ğŸ§µ","ğŸ§¶","ğŸª","ğŸ§¸","ğŸˆ","ğŸ€","ğŸ","ğŸ’«",
      "ğŸª…","ğŸ°","ğŸ©","ğŸª","ğŸ¿","ğŸ«","ğŸ”","ğŸŸ","ğŸ£","ğŸ¤","ğŸœ","ğŸ™","ğŸ›","ğŸ","ğŸŒ®",
      "ğŸŒ¯","ğŸ¥Ÿ","ğŸ±","ğŸ¥¨","ğŸ§€","ğŸ¥—","ğŸ¥ª","ğŸ¥","ğŸ³","ğŸ¥“","ğŸ§‡","ğŸ¥","ğŸ¢","ğŸ¡","ğŸ¶",
      "ğŸ¾","ğŸ·","ğŸ¥¤","ğŸ§ƒ","â˜•","ğŸµ","ğŸ§‹","ğŸº","âš™ï¸","â±ï¸","ğŸ§°","ğŸ”’","ğŸ”‘","ğŸ§¯","ğŸ”­"
    ];

    // ========= ìƒíƒœ =========
    const state = {
      level: 10,
      grid: {cols:8, rows:6},
      deck: [],           // ì¹´ë“œ ë°ì´í„°
      flipped: [],        // í˜„ì¬ ë’¤ì§‘íŒ ì¹´ë“œ ì¸ë±ìŠ¤ 2ê°œ
      matched: new Set(), // ì´ë¯¸ ë§ì¶˜ ì¹´ë“œ ì¸ë±ìŠ¤
      moves: 0,
      score: 0,
      pairsLeft: 0,
      timer: 0,
      running: false,
      interval: null,
      hintOn: false,
      combo: 0,
      soundOn: false,
      darkOn: true
    };

    // ========= ì‚¬ìš´ë“œ(ê°„ë‹¨í•œ ë¹„í”„) =========
    const beep = (freq=660, dur=120, type="sine")=>{
      if(!state.soundOn) return;
      try{
        const ctx = beep._ctx || (beep._ctx = new (window.AudioContext || window.webkitAudioContext)());
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = type; o.frequency.setValueAtTime(freq, ctx.currentTime);
        g.gain.setValueAtTime(0.08, ctx.currentTime);
        o.connect(g); g.connect(ctx.destination);
        o.start(); o.stop(ctx.currentTime + dur/1000);
      }catch(e){}
    };

    // ========= UI ê°±ì‹  =========
    const updateStatus = ()=>{
      $('#moves').textContent = state.moves;
      $('#score').textContent = state.score;
      $('#pairs-left').textContent = state.pairsLeft;
      $('#time').textContent = fmtTime(state.timer);
    };

    const setBoardSize = ()=>{
      const {cols, rows} = state.grid;
      const board = $('#board');
      board.style.gridTemplateColumns = `repeat(${cols}, var(--card-size))`;
      board.style.gridTemplateRows = `repeat(${rows}, var(--card-size))`;

      // ì¹´ë“œ í¬ê¸° ë™ì  ì¡°ì •: ë³´ë“œ í­ì— ë§ì¶¤
      const wrap = $('.board-wrap');
      const availW = wrap.clientWidth - 60; // íŒ¨ë”© ê³ ë ¤
      const availH = wrap.clientHeight - 60;
      const sizeByW = Math.max(54, Math.floor((availW - (cols-1)*10) / cols));
      const sizeByH = Math.max(54, Math.floor((availH - (rows-1)*10) / rows));
      const cardSize = Math.min(sizeByW, sizeByH, 94);
      document.documentElement.style.setProperty('--card-size', `${cardSize}px`);
    };

    // ========= ë± ìƒì„± =========
    const buildDeck = ()=>{
      const {cols, rows} = state.grid;
      let total = cols * rows;

      // í™€ìˆ˜ë©´ í•˜ë‚˜ ì¤„ì—¬ì„œ ì§ìˆ˜ ë§ì¶¤
      if(total % 2 !== 0){
        total -= 1;
      }

      const pairs = total / 2;

      // ì´ëª¨ì§€ ì…”í”Œ í›„ í˜ì–´ë§Œí¼ ì„ íƒ
      const pool = shuffleArr(EMOJIS.slice()).slice(0, pairs);

      const deck = [];
      let idCounter = 0;
      for(const emoji of pool){
        // ë‘ ì¥(í˜ì–´) ìƒì„±
        deck.push({id:idCounter++, emoji, matched:false});
        deck.push({id:idCounter++, emoji, matched:false});
      }

      // ì…”í”Œ
      shuffleArr(deck);

      state.deck = deck;
      state.pairsLeft = pairs;
    };

    // ========= ì¹´ë“œ ìƒì„± ë° ë Œë” =========
    const renderBoard = ()=>{
      const board = $('#board');
      board.innerHTML = '';
      board.setAttribute('aria-rowcount', state.grid.rows);
      board.setAttribute('aria-colcount', state.grid.cols);

      state.deck.forEach((card, idx)=>{
        const el = document.createElement('button');
        el.className = 'card';
        el.setAttribute('role','gridcell');
        el.setAttribute('aria-label','ì¹´ë“œ');
        el.setAttribute('data-index', idx);
        el.setAttribute('tabindex','0');

        const front = document.createElement('div');
        front.className = 'face front';
        const back  = document.createElement('div');
        back.className  = 'face back';

        const em = document.createElement('span');
        em.className = 'emoji';
        em.textContent = card.emoji;

        const badge = document.createElement('span');
        badge.className = 'badge';
        badge.textContent = 'ë ˆë²¨ ' + state.level;

        back.appendChild(em);
        front.appendChild(badge);
        el.appendChild(front);
        el.appendChild(back);

        el.addEventListener('click', onFlip);
        el.addEventListener('keydown', e=>{
          if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); onFlip.call(el, e); }
        });

        board.appendChild(el);
      });

      setBoardSize();
    };

    // ========= ê²Œì„ ì‹œì‘/ì¬ì„¤ì • =========
    const configureLevel = (level)=>{
      state.level = level;
      const g = LEVELS[level];
      state.grid = {...g};

      // ìƒíƒœ ì´ˆê¸°í™”
      state.flipped = [];
      state.matched = new Set();
      state.moves = 0;
      state.score = 0;
      state.combo = 0;

      // ë³´ë“œ ì¤€ë¹„
      buildDeck();
      renderBoard();
      updateStatus();
      toast(`ë ˆë²¨ ${level} ì¤€ë¹„ ì™„ë£Œ! ì¹´ë“œ ìˆ˜: ${state.deck.length}ì¥`);
    };

    const startGame = ()=>{
      if(state.running) return;
      state.running = true;
      state.timer = 0;
      updateStatus();
      state.interval = setInterval(()=>{
        state.timer++;
        $('#time').textContent = fmtTime(state.timer);
      }, 1000);
      beep(520, 100);
      toast('ê²Œì„ ì‹œì‘!');
    };

    const stopGame = ()=>{
      state.running = false;
      clearInterval(state.interval);
      state.interval = null;
    };

    const resetGame = ()=>{
      stopGame();
      configureLevel(state.level);
      beep(400,100);
      toast('ê²Œì„ì´ ì¬ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
    };

    const shuffleBoard = ()=>{
      if(!state.deck.length) return;
      shuffleArr(state.deck);
      renderBoard();
      toast('ì¹´ë“œë¥¼ ì„ì—ˆìŠµë‹ˆë‹¤.');
      beep(720,80,'triangle');
    };

    // ========= ë§¤ì¹­ ë¡œì§ =========
    const lock = { busy:false };

    function onFlip(e){
      if(lock.busy) return;
      if(!state.running){
        // ì‹œì‘í•˜ì§€ ì•Šì€ ê²½ìš° ì²« í´ë¦­ìœ¼ë¡œ ì‹œì‘
        startGame();
      }
      const el = this;
      const idx = Number(el.getAttribute('data-index'));
      if(state.matched.has(idx)) return;
      if(state.flipped.includes(idx)) return;

      // ë’¤ì§‘ê¸°
      el.classList.add('is-flipped');
      state.flipped.push(idx);

      // ì‚¬ìš´ë“œ
      beep(720, 70, 'square');

      if(state.flipped.length === 2){
        lock.busy = true;
        state.moves++;
        updateStatus();

        const [i1,i2] = state.flipped;
        const c1 = state.deck[i1];
        const c2 = state.deck[i2];

        const el1 = document.querySelector(`.card[data-index="${i1}"]`);
        const el2 = document.querySelector(`.card[data-index="${i2}"]`);

        if(c1.emoji === c2.emoji){
          // ë§¤ì¹˜ ì„±ê³µ
          setTimeout(()=>{
            el1.classList.add('is-matched');
            el2.classList.add('is-matched');
            c1.matched = c2.matched = true;
            state.matched.add(i1);
            state.matched.add(i2);
            state.pairsLeft--;
            state.combo++;
            const gain = 100 + Math.floor(25 * state.combo) - Math.min(20, state.moves);
            state.score += Math.max(60, gain);

            updateStatus();
            beep(900, 120, 'triangle');
            lock.busy = false;
            state.flipped = [];

            if(state.pairsLeft === 0){
              // ì™„ë£Œ
              stopGame();
              finaliseStats();
              toast(`ì™„ë£Œ! ì‹œê°„ ${fmtTime(state.timer)}, ì´ë™ ${state.moves}, ì ìˆ˜ ${state.score}`);
              beep(500, 90); setTimeout(()=>beep(650,90),120); setTimeout(()=>beep(800,120),240);
            }
          }, 320);
        }else{
          // ì‹¤íŒ¨: ë‹¤ì‹œ ë’¤ì§‘ê¸°
          state.combo = 0;
          setTimeout(()=>{
            el1.classList.remove('is-flipped');
            el2.classList.remove('is-flipped');
            lock.busy = false;
            state.flipped = [];
            state.score = Math.max(0, state.score - 10);
            updateStatus();
            beep(240, 110, 'sine');
          }, 650);
        }
      }
    }

    // ========= íŒíŠ¸ =========
    let hintTimer = null;
    const toggleHint = (on = !state.hintOn)=>{
      state.hintOn = on;
      if(state.hintOn){
        toast('íŒíŠ¸ í™œì„±í™”: 5ì´ˆë§ˆë‹¤ ì¹´ë“œê°€ ê°•ì¡°ë©ë‹ˆë‹¤.');
        if(hintTimer) clearInterval(hintTimer);
        hintTimer = setInterval(showHintOnce, 5000);
        showHintOnce();
      }else{
        toast('íŒíŠ¸ ë¹„í™œì„±í™”');
        if(hintTimer) clearInterval(hintTimer);
        $$(' .card.hint ').forEach(c=>c.classList.remove('hint'));
      }
    };

    const showHintOnce = ()=>{
      // ì•„ì§ ë§ì¶”ì§€ ì•Šì€ ì¹´ë“œ ì¤‘ í•˜ë‚˜ë¥¼ ê°•ì¡°
      const candidates = [];
      state.deck.forEach((c, idx)=>{
        const el = document.querySelector(`.card[data-index="${idx}"]`);
        if(!c.matched && el && !el.classList.contains('is-flipped')){
          candidates.push(el);
        }
      });
      $$(' .card.hint ').forEach(c=>c.classList.remove('hint'));
      if(candidates.length){
        const pick = candidates[Math.floor(Math.random()*candidates.length)];
        pick.classList.add('hint');
      }
    };

    // ========= í†µê³„ ì €ì¥ =========
    const finaliseStats = ()=>{
      const bestLevel = Number(localStorage.getItem('bestLevel') || 0);
      const bestScore = Number(localStorage.getItem('bestScore') || 0);
      const bestTime = localStorage.getItem('bestTime');
      const bestMoves = localStorage.getItem('bestMoves');

      localStorage.setItem('bestLevel', Math.max(bestLevel, state.level));
      localStorage.setItem('bestScore', Math.max(bestScore, state.score));

      // ì‹œê°„/ì´ë™ì€ ë” ì¢‹ì€ ê°’ìœ¼ë¡œ êµì²´
      const currentTime = state.timer;
      const currentMoves = state.moves;

      const betterTime = (!bestTime) || (currentTime < Number(bestTime));
      const betterMoves = (!bestMoves) || (currentMoves < Number(bestMoves));
      if(betterTime) localStorage.setItem('bestTime', String(currentTime));
      if(betterMoves) localStorage.setItem('bestMoves', String(currentMoves));
      renderStats();
    };

    const renderStats = ()=>{
      const bl = localStorage.getItem('bestLevel');
      const bs = localStorage.getItem('bestScore');
      const bt = localStorage.getItem('bestTime');
      const bm = localStorage.getItem('bestMoves');
      $('#best-level').textContent = bl ? bl : 'â€”';
      $('#best-score').textContent = bs ? bs : 'â€”';
      $('#best-time').textContent = bt ? fmtTime(Number(bt)) : 'â€”';
      $('#best-moves').textContent = bm ? bm : 'â€”';
    };

    // ========= í…Œë§ˆ í† ê¸€ =========
    const toggleDark = ()=>{
      state.darkOn = !state.darkOn;
      document.body.style.background = state.darkOn
        ? 'linear-gradient(120deg, #0b1016, #151a22 60%, #0b1016 100%)'
        : 'linear-gradient(120deg, #f7f9fc, #e8ecf5 60%, #f7f9fc 100%)';
      document.documentElement.style.setProperty('--text', state.darkOn ? '#e6edf3' : '#0c0f14');
      document.documentElement.style.setProperty('--panel', state.darkOn ? '#171a21' : '#ffffff');
      document.documentElement.style.setProperty('--panel-2', state.darkOn ? '#1e232b' : '#f7f7fb');
      document.documentElement.style.setProperty('--accent', state.darkOn ? '#5ee6ad' : '#2b7a0b');
      toast(state.darkOn ? 'ë‹¤í¬ ëª¨ë“œ' : 'ë¼ì´íŠ¸ ëª¨ë“œ');
    };

    // ========= ì´ë²¤íŠ¸ ë°”ì¸ë”© =========
    window.addEventListener('resize', setBoardSize);

    $('#level').addEventListener('change', e=>{
      const lvl = Number(e.target.value);
      configureLevel(lvl);
    });

    $('#start').addEventListener('click', startGame);
    $('#reset').addEventListener('click', resetGame);
    $('#shuffle').addEventListener('click', shuffleBoard);
    $('#hint').addEventListener('click', ()=> toggleHint());
    document.addEventListener('keydown', e=>{
      if(e.key.toLowerCase() === 'h') toggleHint();
    });

    $('#sound').addEventListener('click', e=>{
      state.soundOn = !state.soundOn;
      e.target.setAttribute('aria-pressed', String(state.soundOn));
      e.target.textContent = state.soundOn ? 'ğŸ”Š ì‚¬ìš´ë“œ' : 'ğŸ”ˆ ì‚¬ìš´ë“œ';
      toast(state.soundOn ? 'ì‚¬ìš´ë“œ ì¼œì§' : 'ì‚¬ìš´ë“œ êº¼ì§');
      if(state.soundOn) beep(700,80,'triangle');
    });

    $('#dark').addEventListener('click', e=>{
      toggleDark();
      e.target.setAttribute('aria-pressed', String(state.darkOn));
      e.target.textContent = state.darkOn ? 'ğŸŒ™ ë‹¤í¬' : 'â˜€ï¸ ë¼ì´íŠ¸';
    });

    // ========= ì´ˆê¸°í™” =========
    (function init(){
      renderStats();
      configureLevel(10);   // ìš”ì²­ì— ë”°ë¼ ê¸°ë³¸ ë ˆë²¨ 10
      updateStatus();
      toast('í™˜ì˜í•©ë‹ˆë‹¤! ë ˆë²¨ 10ì„ ì¤€ë¹„í–ˆìŠµë‹ˆë‹¤.');
    })();
  </script>
</body>
</html>
```
