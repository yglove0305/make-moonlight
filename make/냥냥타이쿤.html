<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ëƒ¥ëƒ¥íƒ€ì´ì¿¤ - ê·€ì—¬ìš´ ê³ ì–‘ì´ ì—…ê·¸ë ˆì´ë“œ</title>
  <meta name="description" content="ê·€ì—¬ìš´ ê³ ì–‘ì´ë¥¼ í´ë¦­í•˜ê³ , ì—…ê·¸ë ˆì´ë“œí•˜ê³ , ì œêµ­ì„ ì„¸ìš°ëŠ” ë°©ì¹˜í˜• íƒ€ì´ì¿¤ ê²Œì„"/>
  <style>
    /* ------------------------------
       ê¸°ë³¸ ë¦¬ì…‹ ë° í…Œë§ˆ ë³€ìˆ˜
       ------------------------------ */
    :root{
      --bg: #0f1020;
      --panel: #1a1c3a;
      --panel-2: #23254d;
      --accent: #ff9fd1;
      --accent-2: #ffd166;
      --text: #eaeaf6;
      --muted: #b6b8d6;
      --good: #7ef0a6;
      --warn: #f0d77e;
      --bad: #ff7c7c;
      --shadow: rgba(0,0,0,0.35);
      --focus: #6fb5ff;
      --cat: #ffc5de;
      --link: #9bd1ff;
    }
    *{ box-sizing: border-box }
    html, body{
      height: 100%;
      margin: 0;
      padding: 0;
      background: radial-gradient(1200px 800px at 70% 20%, #151730, var(--bg));
      color: var(--text);
      font-family: "Pretendard", "Apple SD Gothic Neo", "Noto Sans KR", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Malgun Gothic", sans-serif;
    }
    a{ color: var(--link); text-decoration: none }
    a:hover{ text-decoration: underline }

    /* ------------------------------
       ë ˆì´ì•„ì›ƒ
       ------------------------------ */
    .app{
      display: grid;
      grid-template-columns: 320px 1fr 360px;
      grid-template-rows: auto 1fr auto;
      gap: 14px;
      height: 100%;
      padding: 14px;
    }
    header{
      grid-column: 1 / 4;
      background: linear-gradient(180deg, var(--panel), var(--panel-2));
      box-shadow: 0 10px 24px var(--shadow);
      border-radius: 16px;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .brand{
      display: flex;
      align-items: center;
      gap: 14px;
    }
    .brand-logo{
      width: 48px; height: 48px;
      border-radius: 50%;
      background:
        radial-gradient(16px 16px at 35% 35%, white, rgba(255,255,255,0)),
        radial-gradient(60px 60px at 60% 60%, var(--cat), rgba(255,255,255,0));
      border: 2px solid var(--accent);
      box-shadow: 0 6px 14px var(--shadow);
      position: relative;
    }
    .brand-logo::before{
      content:"";
      position:absolute; inset: 7px;
      border-radius: 50%;
      box-shadow: inset 0 0 0 2px rgba(255,255,255,0.15);
    }
    .brand-title{
      font-size: 22px; font-weight: 800; letter-spacing: .5px;
    }
    .brand-sub{
      font-size: 12px; color: var(--muted);
    }
    .actions{
      display: flex; gap: 10px;
    }
    .btn{
      appearance: none;
      background: var(--accent-2);
      color: #241f05;
      border: none;
      border-radius: 10px;
      padding: 10px 12px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 6px 14px var(--shadow);
      transition: transform .06s ease, box-shadow .2s ease, filter .2s ease;
    }
    .btn:hover{ transform: translateY(-1px); filter: brightness(1.05) }
    .btn:active{ transform: translateY(1px); }
    .btn.secondary{
      background: #3b3e70;
      color: var(--text);
    }
    .btn.warn{
      background: var(--warn);
      color: #352c04;
    }
    .btn.bad{
      background: var(--bad);
      color: #2b0b0b;
    }

    nav.sidebar{
      background: linear-gradient(180deg, var(--panel-2), var(--panel));
      border-radius: 16px;
      box-shadow: 0 10px 24px var(--shadow);
      padding: 14px;
      overflow: auto;
    }
    main.game{
      background: linear-gradient(180deg, #141633, #0f1129);
      border-radius: 16px;
      box-shadow: 0 10px 24px var(--shadow);
      position: relative;
      overflow: hidden;
    }
    aside.rightbar{
      background: linear-gradient(180deg, var(--panel-2), var(--panel));
      border-radius: 16px;
      box-shadow: 0 10px 24px var(--shadow);
      padding: 14px;
      overflow: auto;
    }
    footer{
      grid-column: 1 / 4;
      display: flex; align-items: center; justify-content: space-between;
      color: var(--muted);
      font-size: 12px;
    }

    /* ------------------------------
       ì‚¬ì´ë“œë°”: ì—…ê·¸ë ˆì´ë“œ ëª©ë¡
       ------------------------------ */
    .section-title{
      font-size: 16px; font-weight: 800; letter-spacing: .2px; margin: 10px 0 6px 0;
    }
    .muted{ color: var(--muted) }
    .upgrade-list{
      display: grid; gap: 10px;
    }
    .card{
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 6px 18px var(--shadow);
    }
    .upgrade{
      display: grid;
      grid-template-columns: 56px 1fr auto;
      gap: 10px; align-items: center;
    }
    .upgrade .icon{
      width: 56px; height: 56px; border-radius: 12px;
      background: radial-gradient(24px 24px at 35% 35%, rgba(255,255,255,0.85), rgba(255,255,255,0)),
                  linear-gradient(180deg, #ffedf6, #ffd1e6);
      box-shadow: inset 0 0 0 2px rgba(0,0,0,0.06), 0 6px 14px var(--shadow);
      position: relative;
    }
    .upgrade .icon::after{
      content:"ğŸ±";
      position:absolute; inset: 0;
      display:flex; align-items:center; justify-content:center;
      font-size: 28px;
    }
    .upgrade .info{
      display: flex; flex-direction: column; gap: 4px;
    }
    .upgrade .name{
      font-weight: 800; font-size: 14px;
    }
    .upgrade .desc{
      font-size: 12px; color: var(--muted);
    }
    .upgrade .price{
      font-weight: 800; font-size: 14px; color: var(--accent-2);
      text-align: right;
    }
    .upgrade .controls{
      grid-column: 1 / 4; display:flex; gap: 8px; margin-top: 8px;
    }
    .upgrade .buy-btn{
      flex: 1;
      background: #6fe3a0; color: #082012;
      border-radius: 10px; font-weight: 800; border: none; padding: 8px 10px;
      cursor: pointer; transition: filter .2s ease, transform .06s ease;
      box-shadow: 0 6px 12px var(--shadow);
    }
    .upgrade .buy-btn:hover{ filter: brightness(1.05) }
    .upgrade .buy-btn:active{ transform: translateY(1px) }
    .upgrade.locked .buy-btn{
      background: #525678; color: #cbd0ff; cursor: not-allowed;
    }
    .progress-bar{
      height: 8px; border-radius: 999px; background: rgba(255,255,255,0.06);
      overflow: hidden; margin-top: 8px;
    }
    .progress-fill{
      height: 100%; background: linear-gradient(90deg, var(--accent), var(--accent-2));
      width: 0%;
    }

    /* ------------------------------
       ë©”ì¸ ìº£ ìº”ë²„ìŠ¤
       ------------------------------ */
    .game-wrap{
      position: absolute; inset: 0; display: grid;
      grid-template-columns: 1fr; grid-template-rows: 1fr auto;
    }
    .canvas{
      position: relative;
      display: grid;
      place-items: center;
      overflow: hidden;
    }
    .sky{
      position:absolute; inset:0;
      background:
        radial-gradient(800px 400px at 20% 10%, rgba(255,255,255,0.06), rgba(255,255,255,0)),
        radial-gradient(900px 500px at 85% 5%, rgba(255,255,255,0.06), rgba(255,255,255,0));
      pointer-events:none;
    }
    .stars{
      position:absolute; inset:0;
      background-image:
        radial-gradient(1px 1px at 10% 20%, rgba(255,255,255,0.75), rgba(255,255,255,0)),
        radial-gradient(1px 1px at 40% 40%, rgba(255,255,255,0.65), rgba(255,255,255,0)),
        radial-gradient(1px 1px at 75% 15%, rgba(255,255,255,0.75), rgba(255,255,255,0)),
        radial-gradient(1px 1px at 20% 70%, rgba(255,255,255,0.8), rgba(255,255,255,0)),
        radial-gradient(1px 1px at 60% 85%, rgba(255,255,255,0.7), rgba(255,255,255,0));
      opacity:.6;
      pointer-events:none;
    }
    .ground{
      position:absolute; left:0; right:0; bottom:-50px; height: 240px;
      background: linear-gradient(180deg, #0e0f22, #0a0b18);
      box-shadow: inset 0 60px 80px rgba(0,0,0,0.35);
      border-top-left-radius: 50% 20%;
      border-top-right-radius: 50% 20%;
    }
    .big-cat{
      width: 280px; height: 280px;
      border-radius: 50%;
      background: radial-gradient(140px 140px at 40% 40%, #ffeef6, #ffd5e8);
      box-shadow: inset 0 0 0 3px rgba(0,0,0,0.06), 0 16px 32px var(--shadow);
      position: relative; cursor: pointer;
      transform: translateY(-20px);
      transition: transform .08s ease, filter .2s ease;
    }
    .big-cat:hover{ filter: brightness(1.03) }
    .big-cat:active{ transform: translateY(-16px) scale(.99) }
    .big-cat .ear{
      position:absolute; width: 82px; height: 82px; top: -8px;
      background: linear-gradient(180deg, #ffe3f0, #ffc7de);
      border-radius: 10px 90px 10px 90px;
      transform: rotate(45deg);
      box-shadow: 0 10px 20px var(--shadow), inset 0 0 0 3px rgba(0,0,0,0.06);
    }
    .big-cat .ear.right{
      right: 30px;
    }
    .big-cat .ear.left{
      left: 30px; transform: rotate(-45deg);
    }
    .big-cat .face{
      position:absolute; inset: 0;
      display:flex; flex-direction: column;
      align-items:center; justify-content:center; gap: 10px;
    }
    .big-cat .eyes{
      display:flex; gap: 38px;
    }
    .eye{
      width: 24px; height: 24px; border-radius: 50%;
      background: radial-gradient(8px 8px at 35% 35%, white, rgba(255,255,255,0)),
                  radial-gradient(13px 13px at 60% 65%, #333, #111);
      box-shadow: inset 0 0 0 2px rgba(0,0,0,0.25);
      position: relative;
      animation: blink 6s infinite;
    }
    @keyframes blink{
      0%, 96%, 100%{ transform: scaleY(1) }
      97%, 99%{ transform: scaleY(0.1) }
    }
    .nose{
      width: 18px; height: 12px; background:#ff96c0; border-radius: 50% 50% 60% 60%;
      box-shadow: 0 2px 8px rgba(0,0,0,0.25);
    }
    .whiskers{
      width: 180px; height: 40px; position: relative;
    }
    .whiskers::before,.whiskers::after{
      content:"";
      position:absolute; left:0; right:0; top: 8px; height:2px;
      background: linear-gradient(90deg, rgba(255,255,255,0.2), rgba(255,255,255,0.7), rgba(255,255,255,0.2));
    }
    .whiskers::after{ top: 20px }

    .floating-text{
      position:absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      font-weight: 800; font-size: 22px; color: var(--accent-2);
      text-shadow: 0 2px 12px rgba(0,0,0,0.35);
      opacity: 0; pointer-events:none;
    }

    /* ------------------------------
       ë©”ì¸ í•˜ë‹¨ HUD
       ------------------------------ */
    .hud{
      display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px;
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0));
      padding: 10px; border-top: 1px solid rgba(255,255,255,0.08);
    }
    .hud .panel{
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px; padding: 10px;
      box-shadow: 0 6px 14px var(--shadow);
      min-height: 86px;
    }
    .stat{
      display:flex; align-items:center; justify-content: space-between; gap: 8px;
    }
    .stat .label{ font-size: 12px; color: var(--muted) }
    .stat .value{ font-size: 18px; font-weight: 800 }
    .stat .delta{ font-size: 12px; color: var(--good) }

    .ach-list, .log-list{
      display: grid; gap: 8px; max-height: 160px; overflow:auto;
    }
    .ach{
      display:flex; gap: 8px; align-items:center; font-size: 13px;
    }
    .ach .medal{
      width: 22px; height: 22px; border-radius: 6px;
      background: linear-gradient(180deg, #ffe8ac, #ffc24a);
      box-shadow: 0 2px 8px var(--shadow);
    }

    .log{
      font-size: 12px; color: var(--muted);
    }

    /* ------------------------------
       ì˜¤ë¥¸ìª½ ë°”: ìƒì , ì—°êµ¬, ë°˜ë ¤ë¬˜
       ------------------------------ */
    .tabs{
      display:flex; gap: 8px; margin-bottom: 8px;
    }
    .tab{
      flex:1; text-align:center; padding: 8px 10px; font-weight: 800; cursor: pointer;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px;
      transition: filter .2s ease;
    }
    .tab.active{
      background: linear-gradient(180deg, var(--accent), var(--accent-2));
      color: #221b03; border-color: rgba(0,0,0,0.1);
    }
    .tab:hover{ filter: brightness(1.05) }

    .store, .research, .companions{
      display: none;
    }
    .store.active, .research.active, .companions.active{
      display: grid; gap: 10px;
    }
    .item{
      display:grid; grid-template-columns: 64px 1fr auto; gap: 10px; align-items:center;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px; padding: 10px;
      box-shadow: 0 6px 14px var(--shadow);
    }
    .item .icon{
      width: 64px; height: 64px; border-radius: 12px;
      background: radial-gradient(26px 26px at 40% 40%, rgba(255,255,255,0.9), rgba(255,255,255,0)),
                  linear-gradient(180deg, #e8f9ff, #cdeaff);
      box-shadow: inset 0 0 0 2px rgba(0,0,0,0.06), 0 6px 14px var(--shadow);
      display:flex; align-items:center; justify-content:center; font-size: 30px;
    }
    .item .detail{ display:flex; flex-direction: column; gap: 4px }
    .item .name{ font-weight: 800; font-size: 14px }
    .item .desc{ font-size: 12px; color: var(--muted) }
    .item .price{ font-weight: 800; color: var(--accent-2); text-align:right }
    .item .buy{ grid-column: 1 / 4; display:flex; gap: 8px; margin-top: 8px }
    .item .btn{ flex: 1 }

    .pet-card{
      display:grid; grid-template-columns: 64px 1fr auto; gap: 10px; align-items:center;
      border: 1px dashed rgba(255,255,255,0.18);
      border-radius: 12px; padding: 10px;
      background: rgba(255,255,255,0.03);
    }
    .pet-card .mood{ font-size: 12px; color: var(--muted) }
    .pet-card .affection{
      height: 8px; border-radius: 999px; background: rgba(255,255,255,0.06);
      overflow: hidden; margin-top: 8px;
    }
    .pet-card .affection .fill{
      height: 100%; width: 0%;
      background: linear-gradient(90deg, #9be7ff, #a3ffd1);
    }

    /* ------------------------------
       ì„¤ì •/ëª¨ë‹¬
       ------------------------------ */
    .modal-backdrop{
      position: fixed; inset: 0; background: rgba(0,0,0,0.45);
      display: none; align-items:center; justify-content:center; z-index: 50;
    }
    .modal{
      width: min(680px, 96vw);
      background: linear-gradient(180deg, var(--panel-2), var(--panel));
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 16px; padding: 16px;
      box-shadow: 0 20px 40px var(--shadow);
    }
    .modal h3{ margin: 0 0 10px 0; font-size: 18px }
    .modal .row{ display: grid; grid-template-columns: 1fr auto; align-items:center; gap: 10px; padding: 8px 0 }
    .switch{
      width: 56px; height: 32px; border-radius: 999px;
      background: rgba(255,255,255,0.1);
      position: relative; cursor: pointer;
      box-shadow: inset 0 0 0 2px rgba(255,255,255,0.08);
    }
    .switch .knob{
      width: 26px; height: 26px; border-radius: 50%;
      background: white; position: absolute; top: 3px; left: 3px;
      transition: left .2s ease; box-shadow: 0 4px 10px var(--shadow);
    }
    .switch.active{ background: #aaf49c }
    .switch.active .knob{ left: 27px }

    .tooltip{
      position: absolute; z-index: 40; pointer-events: none;
      background: #2a2d55; color: var(--text); border: 1px solid rgba(255,255,255,0.12);
      border-radius: 8px; padding: 8px 10px; font-size: 12px;
      box-shadow: 0 10px 20px var(--shadow);
      opacity: 0; transform: translateY(4px);
      transition: opacity .12s ease, transform .12s ease;
    }
    .tooltip.show{ opacity: 1; transform: translateY(0) }

    /* ------------------------------
       ë°˜ì‘í˜•
       ------------------------------ */
    @media (max-width: 1100px){
      .app{ grid-template-columns: 1fr; grid-template-rows: auto auto auto 1fr auto; }
      nav.sidebar{ grid-row: 2 }
      aside.rightbar{ grid-row: 3 }
      main.game{ grid-row: 4 }
    }
  </style>
</head>
<body>
  <!-- í—¤ë” -->
  <div class="app">
    <header>
      <div class="brand">
        <div class="brand-logo" aria-hidden="true"></div>
        <div>
          <div class="brand-title">ëƒ¥ëƒ¥íƒ€ì´ì¿¤</div>
          <div class="brand-sub">ê·€ì—¬ìš´ ê³ ì–‘ì´ë¥¼ í´ë¦­í•˜ê³ , í‚¤ìš°ê³ , ì œêµ­ì„ ë§Œë“¤ì–´ìš”</div>
        </div>
      </div>
      <div class="actions">
        <button id="saveBtn" class="btn" title="ìˆ˜ë™ ì €ì¥">ğŸ’¾ ì €ì¥</button>
        <button id="resetBtn" class="btn warn" title="ì´ˆê¸°í™”">â™»ï¸ ì´ˆê¸°í™”</button>
        <button id="settingsBtn" class="btn secondary" title="ì„¤ì •">âš™ï¸ ì„¤ì •</button>
      </div>
    </header>

    <!-- ì¢Œì¸¡: ì—…ê·¸ë ˆì´ë“œ -->
    <nav class="sidebar">
      <div class="section-title">ì—…ê·¸ë ˆì´ë“œ</div>
      <div class="muted">ê³ ì–‘ì´ ìƒì‚°ê³¼ í´ë¦­ ìˆ˜ìµì„ í–¥ìƒì‹œì¼œìš”.</div>
      <div id="upgradeList" class="upgrade-list">
        <!-- ì—…ê·¸ë ˆì´ë“œ í•­ëª©ì´ JSë¡œ ì±„ì›Œì§ -->
      </div>
      <div class="section-title" style="margin-top:14px;">ìë™í™”</div>
      <div class="muted">ìë™ ìˆ˜ì§‘ê³¼ ê´€ë¦¬ ì‹œìŠ¤í…œì„ í™•ì¥í•´ìš”.</div>
      <div id="automationList" class="upgrade-list"></div>

      <div class="section-title" style="margin-top:14px;">íŠ¹ìˆ˜ ê°•í™”</div>
      <div class="muted">í•œê³„ ëŒíŒŒ, í¬ê·€ íš¨ê³¼, ì´ë²¤íŠ¸ ë²„í”„.</div>
      <div id="specialList" class="upgrade-list"></div>
    </nav>

    <!-- ë©”ì¸: ê²Œì„ -->
    <main class="game">
      <div class="game-wrap">
        <div class="canvas">
          <div class="sky" aria-hidden="true"></div>
          <div class="stars" aria-hidden="true"></div>
          <div class="ground" aria-hidden="true"></div>

          <!-- í´ë¦­ ëŒ€ìƒ: ë¹…ìº£ -->
          <div id="bigCat" class="big-cat" aria-label="í° ê³ ì–‘ì´, í´ë¦­í•´ì„œ ìˆ˜ìµ ì–»ê¸°">
            <div class="ear left" aria-hidden="true"></div>
            <div class="ear right" aria-hidden="true"></div>
            <div class="face">
              <div class="eyes">
                <div class="eye"></div>
                <div class="eye"></div>
              </div>
              <div class="nose"></div>
              <div class="whiskers"></div>
            </div>
          </div>

          <div id="floatText" class="floating-text">+0</div>
        </div>

        <!-- í•˜ë‹¨ HUD -->
        <div class="hud">
          <div class="panel">
            <div class="stat">
              <div class="label">ë³´ìœ </div>
              <div id="catsTotal" class="value">0</div>
            </div>
            <div class="stat">
              <div class="label">ì´ˆë‹¹ ìˆ˜ìµ</div>
              <div id="incomePerSec" class="value">0</div>
              <div id="incomeDelta" class="delta">+0</div>
            </div>
          </div>
          <div class="panel">
            <div class="stat">
              <div class="label">í´ë¦­ ë‹¹</div>
              <div id="catsPerClick" class="value">1</div>
            </div>
            <div class="progress-bar" title="í´ë¦­ ì½¤ë³´">
              <div id="comboFill" class="progress-fill"></div>
            </div>
            <div class="muted">ì—°ì† í´ë¦­ ì½¤ë³´: <span id="comboCount">0</span>x</div>
          </div>
          <div class="panel">
            <div class="section-title">ë„ì „ ê³¼ì œ</div>
            <div id="achList" class="ach-list"></div>
          </div>
          <div class="panel">
            <div class="section-title">ë¡œê·¸</div>
            <div id="logList" class="log-list"></div>
          </div>
        </div>
      </div>
    </main>

    <!-- ìš°ì¸¡: ìƒì /ì—°êµ¬/ë°˜ë ¤ë¬˜ -->
    <aside class="rightbar">
      <div class="tabs">
        <div class="tab active" data-tab="store">ìƒì </div>
        <div class="tab" data-tab="research">ì—°êµ¬</div>
        <div class="tab" data-tab="companions">ë°˜ë ¤ë¬˜</div>
      </div>

      <div id="store" class="store active">
        <!-- ìƒì  ì•„ì´í…œì´ JSë¡œ ì±„ì›Œì§ -->
      </div>

      <div id="research" class="research">
        <!-- ì—°êµ¬ í•­ëª©ì´ JSë¡œ ì±„ì›Œì§ -->
      </div>

      <div id="companions" class="companions">
        <!-- ë°˜ë ¤ë¬˜ ì¹´ë“œê°€ JSë¡œ ì±„ì›Œì§ -->
      </div>
    </aside>

    <!-- í‘¸í„° -->
    <footer>
      <div>Â© 2025 NyangNyang Tycoon. All cats are adorable.</div>
      <div>
        <a href="#" id="exportBtn" title="ë‚´ë³´ë‚´ê¸°">ë‚´ë³´ë‚´ê¸°</a> Â·
        <a href="#" id="importBtn" title="ê°€ì ¸ì˜¤ê¸°">ê°€ì ¸ì˜¤ê¸°</a> Â·
        <a href="#" id="creditsBtn" title="í¬ë ˆë”§">í¬ë ˆë”§</a>
      </div>
    </footer>
  </div>

  <!-- ëª¨ë‹¬ -->
  <div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal">
      <h3 id="modalTitle">ì„¤ì •</h3>
      <div id="modalContent">
        <!-- ëª¨ë‹¬ ë‚´ìš© ë™ì  -->
      </div>
      <div style="display:flex; justify-content:flex-end; gap:8px; margin-top:10px;">
        <button id="modalClose" class="btn secondary">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <!-- íˆ´íŒ -->
  <div id="tooltip" class="tooltip" role="tooltip"></div>

  <script>
    /* ============================================================
       ëƒ¥ëƒ¥íƒ€ì´ì¿¤ ê²Œì„ ë¡œì§
       - ë°©ì¹˜í˜• / í´ë¦­í˜• í˜¼í•©
       - ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
       - ì—…ê·¸ë ˆì´ë“œ/ìƒì /ì—°êµ¬/ë°˜ë ¤ë¬˜
       - ë„ì „ ê³¼ì œ/ì´ë²¤íŠ¸/ì½¤ë³´/ë²„í”„
       ============================================================ */

    // ----------------------------
    // ìœ í‹¸ë¦¬í‹°
    // ----------------------------
    const fmt = {
      num(n){
        if(!Number.isFinite(n)) return "âˆ";
        const abs = Math.abs(n);
        if(abs < 1000) return n.toLocaleString();
        const units = ["K","M","B","T","Qa","Qi","Sx","Sp","Oc","No","Dc"];
        let idx = -1;
        let v = abs;
        while(v >= 1000 && idx < units.length - 1){
          v /= 1000; idx++;
        }
        const sign = n < 0 ? "-" : "";
        return `${sign}${v.toFixed(v < 10 ? 2 : v < 100 ? 1 : 0)}${units[idx] ?? ""}`;
      },
      time(ms){
        const s = Math.floor(ms/1000);
        const m = Math.floor(s/60);
        const h = Math.floor(m/60);
        const d = Math.floor(h/24);
        if(d > 0) return `${d}ì¼ ${h%24}ì‹œê°„`;
        if(h > 0) return `${h}ì‹œê°„ ${m%60}ë¶„`;
        if(m > 0) return `${m}ë¶„ ${s%60}ì´ˆ`;
        return `${s}ì´ˆ`;
      }
    };

    const RNG = {
      seed: Math.floor(Math.random()*2**31),
      next(){
        // Park-Miller LCG
        this.seed = (this.seed * 48271) % 0x7fffffff;
        return this.seed / 0x7fffffff;
      },
      pick(arr){ return arr[Math.floor(this.next()*arr.length)] }
    };

    // ----------------------------
    // ê²Œì„ ìƒíƒœ
    // ----------------------------
    const State = {
      version: "1.0.0",
      cats: 0,         // ì´ ë³´ìœ 
      totalEarned: 0,  // ëˆ„ì  íšë“
      perClick: 1,     // í´ë¦­ë‹¹
      perSec: 0,       // ì´ˆë‹¹
      combo: 0,        // í´ë¦­ ì½¤ë³´
      lastClick: 0,
      critChance: 0.05,
      critMult: 2.5,
      softcaps: [],    // ì†Œí”„íŠ¸ìº¡ ì •ë³´
      upgrades: {},    // ì—…ê·¸ë ˆì´ë“œ ë ˆë²¨
      automation: {},
      specials: {},
      items: {},       // ìƒì  ì†Œìœ 
      research: {},    // ì—°êµ¬ ì§„í–‰
      pets: {},        // ë°˜ë ¤ë¬˜ ìƒíƒœ
      buffs: [],       // í™œì„± ë²„í”„
      ach: {},         // ë„ì „ ê³¼ì œ ì™„ë£Œ
      log: [],         // í™œë™ ë¡œê·¸
      settings: {
        sound: true,
        particle: true,
        compactUI: false,
        autosave: true,
        theme: "default",
      },
      lastSave: Date.now(),
      createdAt: Date.now(),
    };

    // ----------------------------
    // ë°ì´í„° ì •ì˜
    // ----------------------------
    const Upgrades = [
      { id:"paw-strength", name:"ë°œë°”ë‹¥ ê·¼ë ¥", group:"basic", desc:"í´ë¦­ ë‹¹ ìˆ˜ìµ +1", base: 50, growth: 1.18, effect(l){ return l } },
      { id:"whisker-wisdom", name:"ìˆ˜ì—¼ì˜ ì§€í˜œ", group:"basic", desc:"ì´ˆë‹¹ ìˆ˜ìµ +2", base: 100, growth: 1.20, effect(l){ return l*2 } },
      { id:"nap-optimization", name:"ìˆ˜ë©´ ìµœì í™”", group:"basic", desc:"í´ë¦­/ì´ˆë‹¹ ìˆ˜ìµ 1% ì¦ê°€", base: 250, growth: 1.16, effect(l){ return 1 + l*0.01 } },
      { id:"fish-snack", name:"ìƒì„  ê°„ì‹", group:"basic", desc:"ì¹˜ëª…íƒ€ í™•ë¥  +0.5%", base: 400, growth: 1.22, effect(l){ return l*0.005 } },
      { id:"laser-chase", name:"ë ˆì´ì € ì¶”ê²© í›ˆë ¨", group:"basic", desc:"ì¹˜ëª…íƒ€ ë°°ìˆ˜ +0.05", base: 550, growth: 1.22, effect(l){ return l*0.05 } },

      { id:"auto-brush", name:"ìë™ ë¸ŒëŸ¬ì‹œ", group:"auto", desc:"ì´ˆë‹¹ ìë™ í´ë¦­ +0.5", base: 900, growth: 1.24, effect(l){ return l*0.5 } },
      { id:"milk-fountain", name:"ìš°ìœ  ë¶„ìˆ˜", group:"auto", desc:"ì´ˆë‹¹ ìˆ˜ìµ +5", base: 1500, growth: 1.22, effect(l){ return l*5 } },
      { id:"toy-factory", name:"ì¥ë‚œê° ê³µì¥", group:"auto", desc:"ìë™í™” íš¨ìœ¨ +2%", base: 2200, growth: 1.18, effect(l){ return 1 + l*0.02 } },

      { id:"purr-overdrive", name:"ê·¸ë¥´ë¦‰ ì˜¤ë²„ë“œë¼ì´ë¸Œ", group:"special", desc:"ì¹˜ëª…íƒ€ í™•ë¥ /ë°°ìˆ˜ ëŒ€í­ ì¦ê°€", base: 7500, growth: 1.3, effect(l){ return { c: l*0.01, m: l*0.2 } } },
      { id:"nine-lives", name:"ì•„í™‰ ìƒëª…", group:"special", desc:"ì†Œí”„íŠ¸ìº¡ ì™„í™”", base: 12000, growth: 1.28, effect(l){ return 1 + l*0.1 } },
      { id:"royal-cushion", name:"ì™•ì‹¤ ì¿ ì…˜", group:"special", desc:"í´ë¦­ ì½¤ë³´ ìœ ì§€ë ¥â†‘", base: 9800, growth: 1.26, effect(l){ return 1 + l*0.15 } },
    ];

    const StoreItems = [
      { id:"cat-cafe", name:"ê³ ì–‘ì´ ì¹´í˜", icon:"â˜•ï¸", desc:"ë°©ë¬¸ê°ì´ ê³ ì–‘ì´ì—ê²Œ ì‚¬ë‘ì„ ì¤ë‹ˆë‹¤. ì´ˆë‹¹ +20", price: 5000, effect(){ State.perSec += 20 } },
      { id:"sunny-window", name:"í–‡ì‚´ ê°€ë“ ì°½ë¬¸", icon:"ğŸŒ", desc:"ê³ ì–‘ì´ ë§Œì¡±ë„ ì¦ê°€. í´ë¦­ +10", price: 4200, effect(){ State.perClick += 10 } },
      { id:"scratching-post", name:"ìŠ¤í¬ë˜ì²˜ íƒ€ì›Œ", icon:"ğŸ—¼", desc:"ìë™ í´ë¦­ +2", price: 6400, effect(){ State.perSec += 2 } },
      { id:"yarn-warehouse", name:"í„¸ì‹¤ ì°½ê³ ", icon:"ğŸ§¶", desc:"ìë™í™” íš¨ìœ¨ +5%", price: 8800, effect(){ Buffs.apply({ id:"auto-eff", name:"ìë™í™” ìƒìŠ¹", dur: 180000, multAuto: 1.05 }) } },
      { id:"silver-bowl", name:"ì€ë¹› ê·¸ë¦‡", icon:"ğŸ¥£", desc:"ì¹˜ëª…íƒ€ í™•ë¥  +1%", price: 7600, effect(){ State.critChance += 0.01 } },
    ];

    const Researches = [
      { id:"sleep-science", name:"ìˆ˜ë©´ ê³¼í•™", icon:"ğŸ›ï¸", desc:"íœ´ì‹ ì¤‘ ì´ˆë‹¹ ìˆ˜ìµ ìœ ì§€", price: 12000, time: 60000, effect(){ Buffs.apply({ id:"rest-keep", name:"ìˆ˜ë©´ ìœ ì§€", dur: 600000, restKeep: true }) } },
      { id:"diet-balance", name:"ì‹ë‹¨ ê· í˜•", icon:"ğŸ—", desc:"ì¹˜ëª…íƒ€ ë°°ìˆ˜ +0.4", price: 16000, time: 90000, effect(){ State.critMult += 0.4 } },
      { id:"purr-physics", name:"ê·¸ë¥´ë¦‰ ë¬¼ë¦¬í•™", icon:"ğŸ“", desc:"ê·¸ë¥´ë¦‰ì€ ì—ë„ˆì§€ë‹¤. ì´ˆë‹¹ +30", price: 18000, time: 120000, effect(){ State.perSec += 30 } },
      { id:"meow-linguistics", name:"ì•¼ì˜¹ ì–¸ì–´í•™", icon:"ğŸ”¤", desc:"í´ë¦­ +20", price: 14000, time: 75000, effect(){ State.perClick += 20 } },
    ];

    const Pets = [
      { id:"momo", name:"ëª¨ëª¨", icon:"ğŸˆ", mood:"ì¡¸ë ¤ìš”", affection:0, gain: 0.25, bonus(){ State.perClick += 1 } },
      { id:"nabi", name:"ë‚˜ë¹„", icon:"ğŸˆâ€â¬›", mood:"ì¥ë‚œì³ìš”", affection:0, gain: 0.35, bonus(){ State.perSec += 1 } },
      { id:"ddochi", name:"ë˜ì¹˜", icon:"ğŸ±", mood:"ê¶ê¸ˆí•´ìš”", affection:0, gain: 0.3, bonus(){ State.critChance += 0.002 } },
    ];

    const Achievements = [
      { id:"first-meow", name:"ì²« ì•¼ì˜¹", desc:"ì²˜ìŒìœ¼ë¡œ ê³ ì–‘ì´ë¥¼ íšë“", cond(){ return State.totalEarned >= 1 } },
      { id:"hundred-cats", name:"ë°±ëƒ¥", desc:"100 ê³ ì–‘ì´ ë³´ìœ ", cond(){ return State.cats >= 100 } },
      { id:"combo-10", name:"ì½¤ë³´ ì¥ì¸", desc:"ì½¤ë³´ 10 ë‹¬ì„±", cond(){ return State.combo >= 10 } },
      { id:"big-crit", name:"ëŒ€ë°• ì¹˜ëª…íƒ€", desc:"í•œ ë²ˆì— 100 ì´ìƒ íšë“", cond(){ return State.lastGain >= 100 } },
      { id:"day-1", name:"ì²« í•˜ë£¨", desc:"í”Œë ˆì´ ì‹œê°„ 24ì‹œê°„", cond(){ return Date.now() - State.createdAt >= 86400000 } },
    ];

    // ----------------------------
    // ë²„í”„ ì‹œìŠ¤í…œ
    // ----------------------------
    const Buffs = {
      apply(b){
        // b: { id, name, dur, multClick?, multSec?, multAuto?, restKeep?, ... }
        const now = Date.now();
        const buff = { ...b, start: now, end: now + b.dur };
        // ì¤‘ë³µ ì‹œ ê°±ì‹ 
        const idx = State.buffs.findIndex(x=>x.id===b.id);
        if(idx>=0) State.buffs[idx] = buff; else State.buffs.push(buff);
        log(`ë²„í”„ íšë“: ${b.name} (${fmt.time(b.dur)})`);
        renderBuffs();
      },
      clearExpired(){
        const now = Date.now();
        const before = State.buffs.length;
        State.buffs = State.buffs.filter(b=>b.end > now);
        if(State.buffs.length !== before) renderBuffs();
      },
      getMultipliers(){
        let mClick = 1, mSec = 1, mAuto = 1;
        let restKeep = false;
        for(const b of State.buffs){
          if(b.multClick) mClick *= b.multClick;
          if(b.multSec) mSec *= b.multSec;
          if(b.multAuto) mAuto *= b.multAuto;
          if(b.restKeep) restKeep = true;
        }
        return { mClick, mSec, mAuto, restKeep };
      }
    };

    // ----------------------------
    // DOM ì°¸ì¡°
    // ----------------------------
    const el = {
      catsTotal: document.getElementById("catsTotal"),
      incomePerSec: document.getElementById("incomePerSec"),
      incomeDelta: document.getElementById("incomeDelta"),
      catsPerClick: document.getElementById("catsPerClick"),
      comboFill: document.getElementById("comboFill"),
      comboCount: document.getElementById("comboCount"),
      upgradeList: document.getElementById("upgradeList"),
      automationList: document.getElementById("automationList"),
      specialList: document.getElementById("specialList"),
      store: document.getElementById("store"),
      research: document.getElementById("research"),
      companions: document.getElementById("companions"),
      achList: document.getElementById("achList"),
      logList: document.getElementById("logList"),
      modalBackdrop: document.getElementById("modalBackdrop"),
      modalTitle: document.getElementById("modalTitle"),
      modalContent: document.getElementById("modalContent"),
      modalClose: document.getElementById("modalClose"),
      floatText: document.getElementById("floatText"),
      tooltip: document.getElementById("tooltip"),
      bigCat: document.getElementById("bigCat"),
      saveBtn: document.getElementById("saveBtn"),
      resetBtn: document.getElementById("resetBtn"),
      settingsBtn: document.getElementById("settingsBtn"),
      exportBtn: document.getElementById("exportBtn"),
      importBtn: document.getElementById("importBtn"),
      creditsBtn: document.getElementById("creditsBtn"),
      tabs: Array.from(document.querySelectorAll(".tab")),
    };

    // ----------------------------
    // ë Œë”ë§
    // ----------------------------
    function renderStats(){
      el.catsTotal.textContent = fmt.num(State.cats);
      el.incomePerSec.textContent = fmt.num(getCurrentPerSec());
      el.catsPerClick.textContent = fmt.num(getCurrentPerClick());
      el.comboCount.textContent = State.combo;
    }

    function renderProgress(){
      const fill = Math.min(100, State.combo * 5);
      el.comboFill.style.width = fill + "%";
    }

    function renderUpgrades(){
      const makeCard = (u) => {
        const lvl = State.upgrades[u.id] ?? 0;
        const price = Math.floor(u.base * Math.pow(u.growth, lvl));
        const locked = State.cats < price;
        const groupTitle = {
          basic: "ê¸°ë³¸",
          auto: "ìë™í™”",
          special: "íŠ¹ìˆ˜"
        }[u.group];

        const wrapper = document.createElement("div");
        wrapper.className = "card upgrade" + (locked ? " locked" : "");
        wrapper.setAttribute("data-id", u.id);
        wrapper.innerHTML = `
          <div class="icon" aria-hidden="true"></div>
          <div class="info">
            <div class="name">${u.name} <span class="muted">Lv.${lvl}</span></div>
            <div class="desc">${u.desc} Â· <span class="muted">${groupTitle}</span></div>
          </div>
          <div class="price">â‚©${fmt.num(price)}</div>
          <div class="controls">
            <button class="buy-btn">êµ¬ë§¤</button>
          </div>
          <div class="progress-bar"><div class="progress-fill" style="width:${Math.min(100, lvl*4)}%"></div></div>
        `;
        wrapper.querySelector(".buy-btn").addEventListener("click", () => buyUpgrade(u));
        wrapper.addEventListener("mouseenter", (e)=> showTooltip(e, upgradeTooltip(u, lvl, price)));
        wrapper.addEventListener("mouseleave", hideTooltip);
        return wrapper;
      };

      // ê·¸ë£¹ë³„ ì»¨í…Œì´ë„ˆ ë¹„ìš°ê³  ë‹¤ì‹œ ì±„ìš°ê¸°
      el.upgradeList.innerHTML = "";
      el.automationList.innerHTML = "";
      el.specialList.innerHTML = "";

      Upgrades.forEach(u => {
        const card = makeCard(u);
        if(u.group === "basic") el.upgradeList.appendChild(card);
        else if(u.group === "auto") el.automationList.appendChild(card);
        else el.specialList.appendChild(card);
      });
    }

    function upgradeTooltip(u, lvl, price){
      let preview = "";
      try{
        const eff = u.effect(lvl+1);
        if(typeof eff === "number") preview = `ë‹¤ìŒ íš¨ê³¼: +${fmt.num(eff)} (Lv.${lvl+1})`;
        else if(typeof eff === "object"){
          const parts = [];
          if(eff.c) parts.push(`ì¹˜í™• +${(eff.c*100).toFixed(1)}%`);
          if(eff.m) parts.push(`ì¹˜ë°° +${eff.m.toFixed(2)}x`);
          preview = `ë‹¤ìŒ íš¨ê³¼: ${parts.join(", ")}`;
        }
      }catch(e){ preview = "íš¨ê³¼ ë¯¸ë¦¬ë³´ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ì–´ìš”"; }
      return `
        <div style="font-weight:800">${u.name} Â· Lv.${lvl}</div>
        <div style="color:#b6b8d6; margin-top:4px">${u.desc}</div>
        <div style="margin-top:6px">ê°€ê²©: â‚©${fmt.num(price)}</div>
        <div style="margin-top:4px; color:#a3ffd1">${preview}</div>
      `;
    }

    function renderStore(){
      el.store.innerHTML = "";
      StoreItems.forEach(item=>{
        const owned = State.items[item.id] ? "ë³´ìœ ì¤‘" : "";
        const locked = State.cats < item.price;
        const wrap = document.createElement("div");
        wrap.className = "item" + (locked ? " locked" : "");
        wrap.setAttribute("data-id", item.id);
        wrap.innerHTML = `
          <div class="icon">${item.icon}</div>
          <div class="detail">
            <div class="name">${item.name} <span class="muted">${owned}</span></div>
            <div class="desc">${item.desc}</div>
          </div>
          <div class="price">â‚©${fmt.num(item.price)}</div>
          <div class="buy">
            <button class="btn">êµ¬ë§¤</button>
          </div>
        `;
        wrap.querySelector(".btn").addEventListener("click", ()=> buyStore(item));
        wrap.addEventListener("mouseenter", (e)=> showTooltip(e, `<b style="font-weight:800">${item.name}</b><div>${item.desc}</div>`));
        wrap.addEventListener("mouseleave", hideTooltip);
        el.store.appendChild(wrap);
      });
    }

    function renderResearch(){
      el.research.innerHTML = "";
      Researches.forEach(r=>{
        const progress = State.research[r.id]?.progress ?? 0;
        const running = State.research[r.id]?.running ?? false;
        const locked = State.cats < r.price && !running;
        const wrap = document.createElement("div");
        wrap.className = "item" + (locked ? " locked" : "");
        wrap.setAttribute("data-id", r.id);
        wrap.innerHTML = `
          <div class="icon">${r.icon}</div>
          <div class="detail">
            <div class="name">${r.name} <span class="muted">${running ? "ì§„í–‰ì¤‘" : ""}</span></div>
            <div class="desc">${r.desc}</div>
          </div>
          <div class="price">${running ? fmt.time(r.time - progress) : "â‚©"+fmt.num(r.price)}</div>
          <div class="buy">
            <button class="btn">${running ? "ì·¨ì†Œ" : "ì—°êµ¬ ì‹œì‘"}</button>
          </div>
        `;
        wrap.querySelector(".btn").addEventListener("click", ()=> toggleResearch(r));
        wrap.addEventListener("mouseenter", (e)=> showTooltip(e, `<b style="font-weight:800">${r.name}</b><div>${r.desc}</div>`));
        wrap.addEventListener("mouseleave", hideTooltip);
        el.research.appendChild(wrap);
      });
    }

    function renderPets(){
      el.companions.innerHTML = "";
      Pets.forEach(p=>{
        const st = State.pets[p.id] ?? { affection:0, mood:p.mood };
        const wrap = document.createElement("div");
        wrap.className = "pet-card";
        wrap.setAttribute("data-id", p.id);
        wrap.innerHTML = `
          <div class="icon">${p.icon}</div>
          <div class="detail">
            <div class="name">${p.name}</div>
            <div class="mood">${st.mood} Â· í˜¸ê°ë„ ${Math.floor(st.affection)}%</div>
            <div class="affection"><div class="fill" style="width:${Math.min(100, st.affection)}%"></div></div>
          </div>
          <div>
            <button class="btn">ì“°ë‹¤ë“¬ê¸°</button>
          </div>
        `;
        wrap.querySelector(".btn").addEventListener("click", ()=> petPet(p));
        wrap.addEventListener("mouseenter", (e)=> showTooltip(e, `<b style="font-weight:800">${p.name}</b><div>í•¨ê»˜í•˜ë©´ ë³´ë„ˆìŠ¤ê°€ ëŠ˜ì–´ë‚˜ìš”.</div>`));
        wrap.addEventListener("mouseleave", hideTooltip);
        el.companions.appendChild(wrap);
      });
    }

    function renderAchievements(){
      el.achList.innerHTML = "";
      Achievements.forEach(a=>{
        const ok = !!State.ach[a.id];
        const wrap = document.createElement("div");
        wrap.className = "ach";
        wrap.innerHTML = `
          <div class="medal" style="${ok ? '' : 'filter:grayscale(1); opacity:.6'}"></div>
          <div><b style="font-weight:800">${a.name}</b> <span class="muted">â€” ${a.desc}</span></div>
        `;
        el.achList.appendChild(wrap);
      });
    }

    function renderBuffs(){
      // ë²„í”„ëŠ” ì˜¤ë¥¸ìª½ ìƒë‹¨ íˆ´íŒì— ì ì • í‘œì‹œí•˜ê±°ë‚˜ ë¡œê·¸ì— ê¸°ë¡
      // ì—¬ê¸°ì„œëŠ” ë¡œê·¸ì— ê°„ë‹¨ í‘œì‹œë§Œ ìœ ì§€
      // (UI í™•ì¥ í¬ì¸íŠ¸)
    }

    function renderAll(){
      renderStats();
      renderProgress();
      renderUpgrades();
      renderStore();
      renderResearch();
      renderPets();
      renderAchievements();
    }

    // ----------------------------
    // ìƒí˜¸ì‘ìš©
    // ----------------------------
    function gainCats(amount, source="ê¸°ë³¸"){
      const mult = Buffs.getMultipliers();
      const final = amount * mult.mClick;
      State.cats += final;
      State.totalEarned += final;
      State.lastGain = final;
      el.incomeDelta.textContent = `+${fmt.num(final)}`;
      flashFloat(`+${fmt.num(final)}`);
      log(`${source}: +${fmt.num(final)}`);
      checkAchievements();
      renderStats();
    }

    function autoGain(){
      const mult = Buffs.getMultipliers();
      const perSec = getCurrentPerSec() * mult.mSec * mult.mAuto;
      const perTick = perSec / TICK_RATE;
      State.cats += perTick;
      State.totalEarned += perTick;
      State.lastGain = perTick;
      checkAchievements();
    }

    function getCurrentPerClick(){
      const lvlOpt = State.upgrades["nap-optimization"] ?? 0;
      const opt = Upgrades.find(u=>u.id==="nap-optimization").effect(lvlOpt);
      return (State.perClick + (State.upgrades["paw-strength"] ?? 0)) * opt;
    }

    function getCurrentPerSec(){
      const lvlWis = State.upgrades["whisker-wisdom"] ?? 0;
      const base = State.perSec + (lvlWis*2);
      const lvlToy = State.upgrades["toy-factory"] ?? 0;
      const autoEff = Upgrades.find(u=>u.id==="toy-factory").effect(lvlToy);
      const lvlMilk = State.upgrades["milk-fountain"] ?? 0;
      const milk = lvlMilk*5;
      const lvlNap = State.upgrades["nap-optimization"] ?? 0;
      const opt = Upgrades.find(u=>u.id==="nap-optimization").effect(lvlNap);
      return (base + milk) * autoEff * opt;
    }

    function clickCat(){
      // ì½¤ë³´ ê³„ì‚°
      const now = Date.now();
      const dt = now - State.lastClick;
      const decayMs = 1500 * ((State.upgrades["royal-cushion"] ?? 0) > 0 ? Upgrades.find(u=>u.id==="royal-cushion").effect(State.upgrades["royal-cushion"]).toFixed ? 1 : (1 + (State.upgrades["royal-cushion"] ?? 0)*0.15) : 1);
      if(dt < decayMs) State.combo++; else State.combo = 1;
      State.lastClick = now;

      const base = getCurrentPerClick();
      const crit = RNG.next() < State.critChance + (State.upgrades["purr-overdrive"] ? Upgrades.find(u=>u.id==="purr-overdrive").effect(State.upgrades["purr-overdrive"]).c : 0);
      const mult = crit ? (State.critMult + (State.upgrades["laser-chase"] ?? 0)*0.05 + (State.upgrades["purr-overdrive"] ? Upgrades.find(u=>u.id==="purr-overdrive").effect(State.upgrades["purr-overdrive"]).m : 0)) : 1;
      const comboMult = 1 + Math.min(2, State.combo * 0.03);
      const amount = base * mult * comboMult;
      gainCats(amount, crit ? "ì¹˜ëª…íƒ€ í´ë¦­" : "í´ë¦­");

      // UI
      el.comboCount.textContent = State.combo;
      el.comboFill.style.width = Math.min(100, State.combo * 5) + "%";
    }

    function buyUpgrade(u){
      const lvl = State.upgrades[u.id] ?? 0;
      const price = Math.floor(u.base * Math.pow(u.growth, lvl));
      if(State.cats < price) return;
      State.cats -= price;
      State.upgrades[u.id] = lvl + 1;

      // íŠ¹ìˆ˜ ì¦‰ì‹œ íš¨ê³¼
      if(u.id === "fish-snack") State.critChance += 0.005;
      if(u.id === "laser-chase") State.critMult += 0.05;
      if(u.id === "milk-fountain") State.perSec += 5;

      log(`ì—…ê·¸ë ˆì´ë“œ êµ¬ë§¤: ${u.name} Lv.${lvl+1}`);
      renderStats();
      renderUpgrades();
    }

    function buyStore(item){
      if(State.items[item.id]){ log("ì´ë¯¸ ë³´ìœ  ì¤‘ì…ë‹ˆë‹¤."); return; }
      if(State.cats < item.price) return;
      State.cats -= item.price;
      State.items[item.id] = true;
      item.effect();
      log(`ìƒì  êµ¬ë§¤: ${item.name}`);
      renderStats();
      renderStore();
    }

    function toggleResearch(r){
      const st = State.research[r.id] ?? { running:false, progress:0 };
      if(st.running){
        st.running = false;
        log(`ì—°êµ¬ ì·¨ì†Œ: ${r.name}`);
      }else{
        if(State.cats < r.price) return;
        State.cats -= r.price;
        st.running = true; st.progress = 0;
        log(`ì—°êµ¬ ì‹œì‘: ${r.name}`);
      }
      State.research[r.id] = st;
      renderResearch();
      renderStats();
    }

    function petPet(p){
      const st = State.pets[p.id] ?? { affection:0, mood:p.mood };
      st.affection = Math.min(100, st.affection + 3 + RNG.next()*2);
      if(st.affection >= 100 && !st.bonusApplied){
        p.bonus(); st.bonusApplied = true;
        log(`ë°˜ë ¤ë¬˜ ${p.name}ì™€ì˜ ìœ ëŒ€ê°€ ê¹Šì–´ì¡Œì–´ìš”! ë³´ë„ˆìŠ¤ íšë“`);
      }else{
        log(`ì“°ë‹¤ë“¬ê¸°: ${p.name} (+${(st.affection).toFixed(1)}%)`);
      }
      // ëœë¤ ê¸°ë¶„ ë³€í™”
      if(RNG.next() < 0.15){
        st.mood = RNG.pick(["ì¡¸ë ¤ìš”", "ì¥ë‚œì³ìš”", "ë°°ê³ íŒŒìš”", "ì‹ ë‚˜ìš”", "ì‹¬ì‹¬í•´ìš”"]);
      }
      State.pets[p.id] = st;
      renderPets();
    }

    // ----------------------------
    // ë„ì „ ê³¼ì œ
    // ----------------------------
    function checkAchievements(){
      Achievements.forEach(a=>{
        if(!State.ach[a.id] && a.cond()){
          State.ach[a.id] = true;
          log(`ë„ì „ ê³¼ì œ ë‹¬ì„±: ${a.name}`);
          renderAchievements();
        }
      });
    }

    // ----------------------------
    // ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
    // ----------------------------
    const SAVE_KEY = "nyang-tycoon-save";
    function save(){
      try{
        const data = JSON.stringify(State);
        localStorage.setItem(SAVE_KEY, data);
        State.lastSave = Date.now();
        log("ê²Œì„ ì €ì¥ ì™„ë£Œ");
      }catch(e){
        log("ì €ì¥ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆì–´ìš”.");
      }
    }
    function load(){
      try{
        const raw = localStorage.getItem(SAVE_KEY);
        if(!raw) return;
        const obj = JSON.parse(raw);
        Object.assign(State, obj);
        log("ê²Œì„ ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ");
      }catch(e){
        log("ë¶ˆëŸ¬ì˜¤ê¸° ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆì–´ìš”.");
      }
    }
    function reset(){
      if(!confirm("ì •ë§ ì´ˆê¸°í™”í• ê¹Œìš”? ì§„í–‰ ìƒí™©ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤.")) return;
      const keep = { settings: State.settings };
      Object.assign(State, {
        ...keep,
        version: "1.0.0",
        cats: 0, totalEarned:0, perClick:1, perSec:0,
        combo:0, lastClick:0, critChance:0.05, critMult:2.5,
        softcaps:[], upgrades:{}, automation:{}, specials:{},
        items:{}, research:{}, pets:{}, buffs:[], ach:{}, log:[],
        lastSave: Date.now(), createdAt: Date.now(),
      });
      renderAll();
      log("ì´ˆê¸°í™” ì™„ë£Œ");
      save();
    }

    // ----------------------------
    // íˆ´íŒ
    // ----------------------------
    function showTooltip(e, html){
      const tip = el.tooltip;
      tip.innerHTML = html;
      tip.classList.add("show");
      const rect = e.currentTarget.getBoundingClientRect();
      const x = rect.left + rect.width/2;
      const y = rect.top;
      tip.style.left = (x - tip.offsetWidth/2) + "px";
      tip.style.top = (y - tip.offsetHeight - 10 + window.scrollY) + "px";
    }
    function hideTooltip(){
      el.tooltip.classList.remove("show");
    }

    // ----------------------------
    // ëª¨ë‹¬
    // ----------------------------
    function openModal(title, content){
      el.modalTitle.textContent = title;
      el.modalContent.innerHTML = content;
      el.modalBackdrop.style.display = "flex";
      el.modalBackdrop.setAttribute("aria-hidden", "false");
    }
    function closeModal(){
      el.modalBackdrop.style.display = "none";
      el.modalBackdrop.setAttribute("aria-hidden", "true");
    }

    function openSettings(){
      const s = State.settings;
      const row = (label, id, active) => `
        <div class="row">
          <div>${label}</div>
          <div class="switch ${active ? "active":""}" data-id="${id}">
            <div class="knob"></div>
          </div>
        </div>
      `;
      const html = `
        ${row("ì‚¬ìš´ë“œ", "sound", s.sound)}
        ${row("íŒŒí‹°í´", "particle", s.particle)}
        ${row("ì••ì¶• UI", "compactUI", s.compactUI)}
        ${row("ìë™ ì €ì¥", "autosave", s.autosave)}
        <div class="row">
          <div>í…Œë§ˆ</div>
          <div>
            <select id="themeSel" class="btn secondary">
              <option value="default" ${s.theme==="default"?"selected":""}>ê¸°ë³¸</option>
              <option value="spring">ë´„</option>
              <option value="midnight">ìì •</option>
              <option value="sunset">ë…¸ì„</option>
            </select>
          </div>
        </div>
        <div class="row">
          <div>ë²„í”„ ëª©ë¡</div>
          <div class="muted">${State.buffs.map(b=>b.name).join(", ") || "ì—†ìŒ"}</div>
        </div>
        <div class="row">
          <div>ë²„ì „</div>
          <div class="muted">${State.version}</div>
        </div>
      `;
      openModal("ì„¤ì •", html);
      Array.from(el.modalContent.querySelectorAll(".switch")).forEach(sw=>{
        sw.addEventListener("click", ()=>{
          sw.classList.toggle("active");
          const id = sw.getAttribute("data-id");
          State.settings[id] = sw.classList.contains("active");
          save();
        });
      });
      el.modalContent.querySelector("#themeSel").addEventListener("change", (e)=>{
        State.settings.theme = e.target.value;
        applyTheme(State.settings.theme);
        save();
      });
    }

    function openExport(){
      const data = btoa(unescape(encodeURIComponent(JSON.stringify(State))));
      const html = `
        <div class="muted">ì•„ë˜ ì €ì¥ ì½”ë“œë¥¼ ì•ˆì „í•œ ê³³ì— ë³µì‚¬í•´ ë‘ì„¸ìš”.</div>
        <textarea id="exportData" style="width:100%; height:180px; border-radius:8px; background:#12142a; color:${getComputedStyle(document.documentElement).getPropertyValue('--text')}; padding:10px;">${data}</textarea>
        <div style="display:flex; justify-content:flex-end; gap:8px; margin-top:8px;">
          <button class="btn" id="copyExport">ë³µì‚¬</button>
        </div>
      `;
      openModal("ë‚´ë³´ë‚´ê¸°", html);
      el.modalContent.querySelector("#copyExport").addEventListener("click", ()=>{
        const ta = el.modalContent.querySelector("#exportData");
        ta.select(); document.execCommand("copy");
        log("ë‚´ë³´ë‚´ê¸° ë°ì´í„° ë³µì‚¬ ì™„ë£Œ");
      });
    }

    function openImport(){
      const html = `
        <div class="muted">ì €ì¥ ì½”ë“œë¥¼ ë¶™ì—¬ ë„£ìœ¼ì„¸ìš”.</div>
        <textarea id="importData" style="width:100%; height:180px; border-radius:8px; background:#12142a; color:${getComputedStyle(document.documentElement).getPropertyValue('--text')}; padding:10px;"></textarea>
        <div style="display:flex; justify-content:flex-end; gap:8px; margin-top:8px;">
          <button class="btn" id="applyImport">ê°€ì ¸ì˜¤ê¸°</button>
        </div>
      `;
      openModal("ê°€ì ¸ì˜¤ê¸°", html);
      el.modalContent.querySelector("#applyImport").addEventListener("click", ()=>{
        try{
          const raw = el.modalContent.querySelector("#importData").value.trim();
          const json = JSON.parse(decodeURIComponent(escape(atob(raw))));
          Object.assign(State, json);
          closeModal();
          renderAll();
          save();
          log("ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ");
        }catch(e){
          log("ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: ì €ì¥ ì½”ë“œê°€ ì˜¬ë°”ë¥´ì§€ ì•Šì•„ìš”.");
        }
      });
    }

    function openCredits(){
      const html = `
        <div>ëƒ¥ëƒ¥íƒ€ì´ì¿¤ì— í•¨ê»˜í•´ ì¤˜ì„œ ê³ ë§ˆì›Œìš”.</div>
        <ul style="margin:8px 0 0 18px;">
          <li>ê¸°íš: ë‹¹ì‹ ì˜ ì•¼ì˜¹</li>
          <li>ë””ìì¸: ë§ë‘ë§ë‘ ì¿ ì…˜</li>
          <li>ê°œë°œ: ê·¸ë¥´ë¦‰ ìŠ¤íŠœë””ì˜¤</li>
        </ul>
        <div class="muted" style="margin-top:6px;">ëª¨ë“  ê³ ì–‘ì´ëŠ” ì‚¬ë‘ë°›ì•„ì•¼ í•´ìš”.</div>
      `;
      openModal("í¬ë ˆë”§", html);
    }

    // ----------------------------
    // ë¹„ì£¼ì–¼ íš¨ê³¼
    // ----------------------------
    function flashFloat(text){
      const ft = el.floatText;
      ft.textContent = text;
      ft.style.transition = "none";
      ft.style.opacity = "0";
      ft.style.transform = "translate(-50%, -10px)";
      requestAnimationFrame(()=>{
        ft.style.transition = "opacity .12s ease, transform .24s ease";
        ft.style.opacity = "1";
        ft.style.transform = "translate(-50%, -28px)";
        setTimeout(()=>{ ft.style.opacity="0" }, 300);
      });
    }

    function applyTheme(th){
      const root = document.documentElement;
      if(th === "spring"){
        root.style.setProperty("--bg", "#f7fff3");
        root.style.setProperty("--panel", "#eaffea");
        root.style.setProperty("--panel-2", "#def7e1");
        root.style.setProperty("--text", "#203013");
        root.style.setProperty("--muted", "#5a6e4f");
        root.style.setProperty("--accent", "#ff9fd1");
        root.style.setProperty("--accent-2", "#85e07c");
      }else if(th === "midnight"){
        root.style.setProperty("--bg", "#0a0b17");
        root.style.setProperty("--panel", "#151735");
        root.style.setProperty("--panel-2", "#1c1e47");
        root.style.setProperty("--text", "#eaeaf6");
        root.style.setProperty("--muted", "#b6b8d6");
        root.style.setProperty("--accent", "#8aa8ff");
        root.style.setProperty("--accent-2", "#a8ffea");
      }else if(th === "sunset"){
        root.style.setProperty("--bg", "#12080f");
        root.style.setProperty("--panel", "#2a1320");
        root.style.setProperty("--panel-2", "#3a1a2b");
        root.style.setProperty("--text", "#ffeef6");
        root.style.setProperty("--muted", "#f4cbdc");
        root.style.setProperty("--accent", "#ff9f9f");
        root.style.setProperty("--accent-2", "#ffd166");
      }else{
        // default
        root.style.setProperty("--bg", "#0f1020");
        root.style.setProperty("--panel", "#1a1c3a");
        root.style.setProperty("--panel-2", "#23254d");
        root.style.setProperty("--text", "#eaeaf6");
        root.style.setProperty("--muted", "#b6b8d6");
        root.style.setProperty("--accent", "#ff9fd1");
        root.style.setProperty("--accent-2", "#ffd166");
      }
    }

    // ----------------------------
    // ë¡œê¹…
    // ----------------------------
    function log(text){
      State.log.unshift({ t: Date.now(), s: text });
      State.log = State.log.slice(0, 50);
      el.logList.innerHTML = State.log.map(x=> `<div class="log">[${new Date(x.t).toLocaleTimeString()}] ${x.s}</div>`).join("");
    }

    // ----------------------------
    // ë£¨í”„/íƒ€ì´ë°
    // ----------------------------
    const FPS = 60;
    const TICK_RATE = 10; // ì´ˆë‹¹ 10í‹±
    let acc = 0;
    function loop(ts){
      Buffs.clearExpired();
      acc += 1/FPS;
      if(acc >= 1/TICK_RATE){
        acc = 0;
        autoGain();
        renderStats();
      }
      requestAnimationFrame(loop);
    }

    // ----------------------------
    // ì´ë²¤íŠ¸ ë°”ì¸ë”©
    // ----------------------------
    function bind(){
      el.bigCat.addEventListener("click", clickCat);
      el.saveBtn.addEventListener("click", save);
      el.resetBtn.addEventListener("click", reset);
      el.settingsBtn.addEventListener("click", openSettings);
      el.modalClose.addEventListener("click", closeModal);
      el.exportBtn.addEventListener("click", (e)=>{ e.preventDefault(); openExport(); });
      el.importBtn.addEventListener("click", (e)=>{ e.preventDefault(); openImport(); });
      el.creditsBtn.addEventListener("click", (e)=>{ e.preventDefault(); openCredits(); });

      el.tabs.forEach(tab=>{
        tab.addEventListener("click", ()=>{
          el.tabs.forEach(t=> t.classList.remove("active"));
          tab.classList.add("active");
          const name = tab.getAttribute("data-tab");
          ["store","research","companions"].forEach(k=>{
            document.getElementById(k).classList.toggle("active", k===name);
          });
        });
      });

      // í˜ì´ì§€ ì´íƒˆ ì „ ìë™ ì €ì¥
      window.addEventListener("beforeunload", ()=>{
        if(State.settings.autosave) save();
      });
    }

    // ----------------------------
    // ì´ˆê¸°í™”
    // ----------------------------
    function init(){
      load();
      applyTheme(State.settings.theme);
      renderAll();
      bind();
      requestAnimationFrame(loop);
      log("ì–´ì„œ ì™€ìš”! ê³ ì–‘ì´ë¥¼ í´ë¦­í•´ì„œ ì‹œì‘í•´ìš”.");
    }

    init();

    // ----------------------------
    // í™•ì¥ ì•„ì´ë””ì–´ (ê°œë°œìš© ì£¼ì„)
    // - ì‹œì¦Œ ì´ë²¤íŠ¸: ë²šê½ƒ, ì—¬ë¦„ ë°”ìº‰ìŠ¤, í• ë¡œìœˆ, í¬ë¦¬ìŠ¤ë§ˆìŠ¤
    // - ê¸¸ë“¤ì„ ì‹œìŠ¤í…œ: ë°˜ë ¤ë¬˜ íŠ¹ì„± ê°•í™” ë° ì‹œë„ˆì§€
    // - ë¬´í•œ í™•ì¥: í™˜ìƒ(ì „ìƒ), ìœ ì‚°, ëª…ì˜ˆ ì ìˆ˜
    // - ê±°ë˜ì†Œ: ê°„ì‹/ì¥ë‚œê°/ì¿ ì…˜ì˜ êµí™˜ ë¹„ìœ¨
    // - ë©€í‹° ì–¸ì–´: en/ja/ko ìë™ ê°ì§€
    // - í´ë¼ìš°ë“œ ì„¸ì´ë¸Œ: ì—¬ëŸ¬ ê¸°ê¸° ë™ê¸°í™”
    // ----------------------------
  </script>
</body>
</html>
